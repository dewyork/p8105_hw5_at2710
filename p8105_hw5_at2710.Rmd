---
title: "Homework 5"
author: "Anusorn Thanataveerat"
date: "November 1, 2018"
output: github_document
toc: true
toc_float: true
code_folding: hide
---

```{r setup, include=FALSE}
library(tidyverse)
library(janitor)
library(knitr)
library(lubridate)

knitr::opts_chunk$set(echo = TRUE,
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

knitr::knit_hooks$set(inline = function(x) {
prettyNum(x, big.mark=",")
})
```

## Problem 1

```{r Problem_1, message = FALSE}

file_list = list.files(path = 'data/', pattern = "*.csv")

#function to lead each dataset and create id and group variable
read_add_id_arm <- function(x){
  read_csv(paste('data/', x, sep = '')) %>% 
    mutate(id = str_sub(x, 5, 6), arm = str_sub(x, 1, 3))
}

  map_df(.x = file_list, ~ read_add_id_arm(.x)) %>% 
  gather(key = week, value = value, week_1:week_8) %>% 
  separate(week, into = c('remove', 'week'), sep = '_') %>% 
  select(id, arm, everything(), -remove) %>% 
  mutate(arm = as.factor(arm)) %>% 
  #Spaghetti plot
  ggplot(aes(x = as.numeric(week), y = value, color = arm,
  group = interaction(arm, id))) + 
  geom_line() + xlab('Week') +
  scale_color_discrete(name = "Study Arm",
                       breaks = c("con", "exp"),
                      labels = c("Control", "Experimental"))

```

**Answer**: Whatever value it is they are measuring, those in experimental arm increase over time while people in the control arm didn't see any increase within the 8-week duration under study. Actually some saw a decrease in the outcome
  
## Problem 2  
  
``` {r Problem_2}
homicide_dat <-
  read_csv('https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv') %>% 
  mutate(reported_date = ymd(reported_date), 
         city_state = paste(city, state, sep = ', '))
  
```

Describe the raw data. 
The raw data contains `r nrow(homicide_dat)` homicide cases from `r sort(homicide_dat$reported_date)[1]` to the end of 2017 (`r sort(homicide_dat$reported_date, decreasing = TRUE)[1]`). It is collected from `r length(table(homicide_dat$city_state))` cities in `r length(table(homicide_dat$state))` states. According to this data, `r homicide_dat %>% count(city_state) %>% arrange(desc(n)) %>% top_n(1) %>% select(city_state)` has the highest homicide cases (`r homicide_dat %>% count(city_state) %>% arrange(desc(n)) %>% top_n(1) %>% select(n)`). `r round(sort(prop.table(table(homicide_dat$victim_race)), decreasing = T)[1]*100,1)`% of the victims are `r names(sort(prop.table(table(homicide_dat$victim_race)), decreasing = T)[1])` and `r round(prop.table(table(homicide_dat$victim_sex))[2]*100,1)`% are male.
 then summarize within cities to obtain the total number of homicides and the number of unsolved homicides (those for which the disposition is “Closed without arrest” or “Open/No arrest”).



